<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fradin Dashboard</title>
  <style>
    :root {
      --bg:          #0d1117;
      --surface:     #161b22;
      --surface2:    #1c2128;
      --border:      #30363d;
      --text:        #e6edf3;
      --muted:       #8b949e;
      --dim:         #3d444d;
      --dlr:         #2196f3;
      --rail:        #ff7043;
      --eliot:       #ab47bc;
      --solal:       #26c6da;
      --green:       #4caf50;
      --red:         #ef5350;
      --yellow:      #ffa726;
      --cyan:        #00e5ff;
      --dinners:     #FF8A65;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 20px 12px;
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      max-width: 980px;
      margin: 0 auto 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .header-left .location {
      font-size: 0.7rem;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .clock {
      font-size: 3.8rem;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      letter-spacing: -1px;
      line-height: 1;
      color: var(--text);
    }

    .header-right {
      text-align: right;
    }

    .date-day {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }

    .date-full {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 2px;
    }

    /* â”€â”€ TAB BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tab-bar {
      display: flex;
      max-width: 980px;
      margin: 0 auto;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }

    .tab-btn {
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      color: var(--muted);
      font-family: inherit;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      padding: 8px 18px;
      cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
    }

    .tab-btn:hover { color: var(--text); }

    .tab-btn[data-tab="tab-trains"].active   { border-bottom-color: var(--dlr);     color: var(--dlr);     }
    .tab-btn[data-tab="tab-eliot"].active    { border-bottom-color: var(--eliot);   color: var(--eliot);   }
    .tab-btn[data-tab="tab-solal"].active    { border-bottom-color: var(--solal);   color: var(--solal);   }
    .tab-btn[data-tab="tab-dinners"].active  { border-bottom-color: var(--dinners); color: var(--dinners); }

    .tab-content        { display: none; }
    .tab-content.active { display: block; }

    /* â”€â”€ GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      max-width: 980px;
      margin: 0 auto;
    }

    /* â”€â”€ SECTION CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--surface);
      border-radius: 14px;
      padding: 16px 18px;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 9px;
      margin-bottom: 14px;
    }

    .card-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .card-title {
      font-size: 0.68rem;
      font-weight: 700;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .card-subtitle {
      font-size: 0.68rem;
      color: var(--dim);
      margin-left: auto;
    }

    /* â”€â”€ TRAIN ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .train-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--surface2);
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 8px;
      border-left: 4px solid transparent;
    }

    .train-row.dlr-row  { border-left-color: var(--dlr); }
    .train-row.rail-row { border-left-color: var(--rail); }
    .train-row.urgent   { background: #1a1010; }
    .train-row.urgent .train-mins { color: var(--red); }

    .train-dest {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .train-op {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .train-mins {
      font-size: 2rem;
      font-weight: 700;
      color: var(--cyan);
      text-align: right;
      line-height: 1;
      min-width: 52px;
    }

    .train-mins small {
      font-size: 0.62rem;
      color: var(--muted);
      display: block;
    }

    .due { color: var(--red) !important; }
    .on-time { color: var(--green); }
    .late    { color: var(--red); }

    /* â”€â”€ LESSON ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .lesson-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 9px 10px;
      border-radius: 8px;
      margin-bottom: 5px;
      border-left: 3px solid transparent;
    }

    .lesson-time {
      font-size: 0.72rem;
      font-variant-numeric: tabular-nums;
      color: var(--muted);
      line-height: 1.5;
      min-width: 38px;
    }

    .lesson-subject {
      font-size: 0.9rem;
      font-weight: 600;
      flex: 1;
    }

    .lesson-badge {
      font-size: 0.58rem;
      font-weight: 700;
      letter-spacing: 1px;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* States */
    .is-past .lesson-subject,
    .is-past .lesson-time {
      color: var(--dim);
    }

    .is-current {
      background: var(--surface2);
      border-left-color: var(--green);
    }
    .is-current .lesson-time    { color: var(--green); }
    .is-current .lesson-subject { color: var(--text); }

    .is-cancelled .lesson-subject {
      color: var(--red);
      text-decoration: line-through;
      text-decoration-color: var(--red);
    }
    .is-cancelled .lesson-time { color: var(--dim); }
    .is-cancelled .lesson-badge {
      background: rgba(239,83,80,.15);
      color: var(--red);
    }

    /* â”€â”€ DAY HEADER (timetable) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .day-header {
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--muted);
      margin: 14px 0 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border);
    }

    .day-header:first-child { margin-top: 0; }
    .day-header.is-today { color: var(--green); border-bottom-color: var(--green); }

    .lesson-meta {
      font-size: 0.68rem;
      color: var(--muted);
      margin-top: 1px;
    }

    /* â”€â”€ HOMEWORK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hw-day {
      font-size: 0.8rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin: 12px 0 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border);
    }

    .hw-day:first-child { margin-top: 0; }

    .hw-item {
      padding: 5px 0;
    }

    .hw-subject {
      font-size: 0.85rem;
      font-weight: 600;
      display: block;
    }

    .hw-desc {
      font-size: 0.78rem;
      color: var(--muted);
      display: block;
      margin-top: 2px;
    }

    /* â”€â”€ DINNER CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .meal-card {
      background: var(--surface2);
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 10px;
      border-left: 4px solid var(--dinners);
    }

    .meal-day {
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--dinners);
      margin-bottom: 4px;
    }

    .meal-name {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .meal-desc { font-size: 0.78rem; color: var(--muted); }
    .meal-uses { font-size: 0.68rem; color: var(--dim); margin-top: 4px; }

    .veg-item {
      display: inline-block;
      background: var(--surface2);
      border-radius: 6px;
      padding: 4px 10px;
      margin: 3px;
      font-size: 0.8rem;
    }

    /* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      max-width: 980px;
      margin: 14px auto 0;
      display: flex;
      justify-content: space-between;
      font-size: 0.62rem;
      color: var(--dim);
    }

    /* â”€â”€ STATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .msg {
      font-size: 0.85rem;
      padding: 6px 2px;
    }
    .msg-empty { color: var(--muted); }
    .msg-error { color: var(--red); }

    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 640px) {
      .grid { grid-template-columns: 1fr; }
      .clock { font-size: 2.8rem; }
      .header { flex-direction: column; align-items: flex-start; gap: 6px; }
      .header-right { text-align: left; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <div class="location">Greenwich Â· London</div>
      <div class="clock" id="clock">--:--:--</div>
    </div>
    <div class="header-right">
      <div class="date-day" id="date-day">--</div>
      <div class="date-full" id="date-full">--</div>
    </div>
  </div>

  <!-- TAB BAR -->
  <nav class="tab-bar">
    <button class="tab-btn active" data-tab="tab-trains">Trains</button>
    <button class="tab-btn" data-tab="tab-eliot">Eliot</button>
    <button class="tab-btn" data-tab="tab-solal">Solal</button>
    <button class="tab-btn" data-tab="tab-dinners">Diners</button>
  </nav>

  <!-- TAB: TRAINS -->
  <div id="tab-trains" class="tab-content active">
    <div class="grid">

      <!-- DLR -->
      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--dlr)"></div>
          <div class="card-title">DLR â†’ Bank</div>
        </div>
        <div id="dlr-trains"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

      <!-- National Rail -->
      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--rail)"></div>
          <div class="card-title">National Rail â†’ London</div>
        </div>
        <div id="rail-trains"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

    </div>
  </div>

  <!-- TAB: ELIOT -->
  <div id="tab-eliot" class="tab-content">
    <div class="grid">

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--eliot)"></div>
          <div class="card-title">Eliot Â· Emploi du temps</div>
        </div>
        <div id="eliot-timetable"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--eliot)"></div>
          <div class="card-title">Eliot Â· Devoirs</div>
        </div>
        <div id="eliot-homework"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

    </div>
  </div>

  <!-- TAB: SOLAL -->
  <div id="tab-solal" class="tab-content">
    <div class="grid">

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--solal)"></div>
          <div class="card-title">Solal Â· Emploi du temps</div>
        </div>
        <div id="solal-timetable"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--solal)"></div>
          <div class="card-title">Solal Â· Devoirs</div>
        </div>
        <div id="solal-homework"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

    </div>
  </div>

  <!-- TAB: DINNERS -->
  <div id="tab-dinners" class="tab-content">
    <div class="grid">

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--dinners)"></div>
          <div class="card-title">Menus de la semaine</div>
        </div>
        <div id="dinners-meals"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-dot" style="background:var(--dinners)"></div>
          <div class="card-title">Box Abel &amp; Cole</div>
        </div>
        <div id="dinners-box"><p class="msg msg-empty">Loadingâ€¦</p></div>
      </div>

    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <span id="train-status">â€“</span>
    <span id="school-status">â€“</span>
    <span>Built 2026-03-01</span>
  </div>

  <script>
    // â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const DAYS   = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const MONTHS = ['January','February','March','April','May','June','July',
                    'August','September','October','November','December'];

    function updateClock() {
      const now = new Date();
      const pad = n => String(n).padStart(2, '0');
      document.getElementById('clock').textContent =
        `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      document.getElementById('date-day').textContent  = DAYS[now.getDay()];
      document.getElementById('date-full').textContent =
        `${now.getDate()} ${MONTHS[now.getMonth()]} ${now.getFullYear()}`;
    }

    // â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn, .tab-content').forEach(e => e.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // â”€â”€ TRAINS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function minsHtml(mins) {
      if (mins <= 1) return `<div class="train-mins due">Due<small>mins</small></div>`;
      return `<div class="train-mins">${mins}<small>mins</small></div>`;
    }

    async function fetchTrains() {
      const dlrEl  = document.getElementById('dlr-trains');
      const railEl = document.getElementById('rail-trains');
      try {
        const r = await fetch('/api/trains');
        if (!r.ok) {
          const msg = ((await r.json()).error) || `HTTP ${r.status}`;
          dlrEl.innerHTML  = `<p class="msg msg-error">DLR unavailable (${msg})</p>`;
          railEl.innerHTML = `<p class="msg msg-error">Rail unavailable (${msg})</p>`;
          return;
        }
        const data = await r.json();

        // DLR
        if (!data.dlr.length) {
          dlrEl.innerHTML = `<p class="msg msg-empty">No DLR trains right now.</p>`;
        } else {
          dlrEl.innerHTML = data.dlr.map(t => {
            const mins = t.mins;
            return `<div class="train-row dlr-row${mins <= 2 ? ' urgent' : ''}">
              <div>
                <div class="train-dest">${t.destination}</div>
                <div class="train-op">DLR</div>
              </div>
              ${minsHtml(mins)}
            </div>`;
          }).join('');
        }

        // Rail
        if (!data.rail.length) {
          railEl.innerHTML = `<p class="msg msg-empty">No London trains right now.</p>`;
        } else {
          railEl.innerHTML = data.rail.map(t => {
            const mins = t.mins;
            const statusHtml = t.status === 'ON TIME'
              ? `<span class="on-time">On time</span>`
              : t.status === 'LATE'
                ? `<span class="late">Late</span>`
                : `<span style="color:var(--muted)">${t.status || ''}</span>`;
            return `<div class="train-row rail-row${mins <= 2 ? ' urgent' : ''}">
              <div>
                <div class="train-dest">${t.destination}</div>
                <div class="train-op">${t.operator} Â· ${statusHtml}</div>
              </div>
              ${minsHtml(mins)}
            </div>`;
          }).join('');
        }

        document.getElementById('train-status').textContent =
          `Trains mis Ã  jour ${data.cached_at || new Date().toLocaleTimeString()}`;
      } catch(e) {
        dlrEl.innerHTML  = `<p class="msg msg-error">DLR unavailable (${e.message})</p>`;
        railEl.innerHTML = `<p class="msg msg-error">Rail unavailable (${e.message})</p>`;
      }
    }

    // â”€â”€ TIMETABLE & HOMEWORK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let _lastTimetable = null;

    function renderHomework(homework, elId) {
      const el = document.getElementById(elId);
      if (!el) return;
      const dates = Object.keys(homework || {});
      if (!dates.length) {
        el.innerHTML = `<p class="msg msg-empty">Pas de devoirs cette semaine.</p>`;
        return;
      }
      el.innerHTML = dates.map(label => {
        return `<div class="hw-day">${label}</div>` +
          (homework[label] || []).map(hw =>
            `<div class="hw-item">
              <span class="hw-subject">${hw.subject}</span>
              <span class="hw-desc">${hw.description}</span>
            </div>`
          ).join('');
      }).join('');
    }

    function renderTimetable(data) {
      _lastTimetable = data;
      const now     = new Date();
      const nowMins = now.getHours() * 60 + now.getMinutes();
      const ttIds   = ['eliot-timetable', 'solal-timetable'];
      const hwIds   = ['eliot-homework',  'solal-homework'];

      data.children.forEach((child, i) => {
        const ttEl = document.getElementById(ttIds[i]);
        if (ttEl) {
          const daysWithLessons = (child.days || []).filter(d => d.lessons.length > 0);
          if (!daysWithLessons.length) {
            ttEl.innerHTML = `<p class="msg msg-empty">Pas de cours cette semaine.</p>`;
          } else {
            ttEl.innerHTML = daysWithLessons.map(day => {
              const headerCls = day.is_today ? 'day-header is-today' : 'day-header';
              const dayLabel  = day.is_today ? `Aujourd'hui Â· ${day.date_fr}` : day.date_fr;
              const lessonsHtml = day.lessons.map(l => {
                let cls = '', badge = '';
                if (l.cancelled) {
                  cls   = 'is-cancelled';
                  badge = `<span class="lesson-badge">AnnulÃ©</span>`;
                } else if (day.is_today) {
                  if (nowMins >= l.end_mins)        cls = 'is-past';
                  else if (nowMins >= l.start_mins) cls = 'is-current';
                }
                const meta = [l.teacher, l.room].filter(Boolean).join(' Â· ');
                return `<div class="lesson-row ${cls}">
                  <div class="lesson-time">${l.start}<br>${l.end}</div>
                  <div style="flex:1">
                    <div class="lesson-subject">${l.subject}</div>
                    ${meta ? `<div class="lesson-meta">${meta}</div>` : ''}
                  </div>
                  ${badge}
                </div>`;
              }).join('');
              return `<div class="${headerCls}">${dayLabel}</div>${lessonsHtml}`;
            }).join('');
          }
        }

        renderHomework(child.homework, hwIds[i]);
      });

      document.getElementById('school-status').textContent =
        `School updated ${data.cached_at || 'â€“'}`;
    }

    async function fetchTimetable() {
      try {
        const r = await fetch('/api/timetable');
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        renderTimetable(await r.json());
      } catch(e) {
        ['eliot-timetable','solal-timetable'].forEach(id => {
          document.getElementById(id).innerHTML =
            `<p class="msg msg-error">Unavailable (${e.message})</p>`;
        });
      }
    }

    // â”€â”€ DINNERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchDinners() {
      const mealsEl = document.getElementById('dinners-meals');
      const boxEl   = document.getElementById('dinners-box');
      try {
        const r = await fetch('/api/dinners');
        if (!r.ok) {
          const msg = ((await r.json()).error) || `HTTP ${r.status}`;
          mealsEl.innerHTML = `<p class="msg msg-empty">${msg}</p>`;
          boxEl.innerHTML   = '';
          return;
        }
        const data = await r.json();

        // Meals
        if (!data.meals || !data.meals.length) {
          mealsEl.innerHTML = `<p class="msg msg-empty">Pas de menus disponibles.</p>`;
        } else {
          mealsEl.innerHTML = data.meals.map(m =>
            `<div class="meal-card">
              <div class="meal-day">${m.day}</div>
              <div class="meal-name">${m.name}</div>
              <div class="meal-desc">${m.description}</div>
              ${m.uses && m.uses.length ? `<div class="meal-uses">ðŸ¥¦ ${m.uses.join(', ')}</div>` : ''}
            </div>`
          ).join('');
        }

        // Box contents
        if (!data.vegetables || !data.vegetables.length) {
          boxEl.innerHTML = `<p class="msg msg-empty">Contenu de la box non disponible.</p>`;
        } else {
          boxEl.innerHTML = data.vegetables.map(v =>
            `<span class="veg-item">${v}</span>`
          ).join('');
        }
      } catch(e) {
        mealsEl.innerHTML = `<p class="msg msg-error">Unavailable (${e.message})</p>`;
        boxEl.innerHTML   = '';
      }
    }

    // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    updateClock();
    setInterval(updateClock, 1000);

    fetchTrains();
    setInterval(fetchTrains, 30000);

    fetchTimetable();
    setInterval(fetchTimetable, 600000);
    setInterval(() => { if (_lastTimetable) renderTimetable(_lastTimetable); }, 60000);

    fetchDinners();
    setInterval(fetchDinners, 600000);
  </script>

</body>
</html>
